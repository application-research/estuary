name: BuildSwaggerClients

on: push

#on:
#push:
##branches: ['master']
#paths: ['*','docs/swagger.json']




jobs:
  BuildSwaggerClients:
    runs-on: ubuntu-latest
    container: swaggerapi/swagger-codegen-cli

    steps:
      - name: Build clients and push
        env:
          SSH_PRIVATE_KEY_ESTUARY_SWAGGER_CLIENTS: ${{ secrets.SSH_PRIVATE_KEY_ESTUARY_SWAGGER_CLIENTS }}
        run: |
          apk add git
          apk add openssh
          echo $SSH_PRIVATE_KEY_ESTUARY_SWAGGER_CLIENTS > secret
          echo >> secret # add new line
          chmod 400 secret
          eval `ssh-agent`
          ssh-add secret
          git clone git@github.com:snissn/estuary-swagger-clients.git
          cd estuary-swagger-clients
          sh build_all.sh
          git status
          git add *
          git config --global user.email "BuildBot@estuary-swagger-client.net"
          git config --global user.name "Build Bot"
          git commit -am "Commit from build bot. Build number $CIRCLE_BUILD_NUM. Workflow ID $CIRCLE_WORKFLOW_ID."
          git push origin main
