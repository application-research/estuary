name: BuildSwaggerClients

on: push

#on:
#push:
##branches: ['master']
#paths: ['*','docs/swagger.json']




jobs:
  BuildSwaggerClients:
    runs-on: ubuntu-latest
    container: swaggerapi/swagger-codegen-cli

    steps:
      - name: Build clients and push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          apk add git
          apk add openssh
          git clone https://user:$GITHUB_TOKEN@github.com/snissn/estuary-swagger-clients.git
          git config --unset-all http.https://github.com/.extraheader
          cd estuary-swagger-clients
          sh build_all.sh
          git status
          git add *
          git config --global user.email "BuildBot@estuary-swagger-client.net"
          git config --global user.name "Build Bot"

          git commit -am "Commit from build bot. Build number $CIRCLE_BUILD_NUM. Workflow ID $CIRCLE_WORKFLOW_ID."
          git push origin main
